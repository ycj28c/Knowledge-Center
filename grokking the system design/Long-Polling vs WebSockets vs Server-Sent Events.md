Long-Polling vs WebSockets vs Server-Sent Events

Long-Polling, WebSocketsh和Server-Sent Events都是常用的用于browser和web server的通信协议。  

## Ajax Polling短轮询
Polling是大部分Ajax应用的标准技术，基本步骤如下：  
1.客户端打开连接并向服务器发动HTTP请求
2.被请求的页面每隔一段时间（比如0.5秒后）向服务器发送请求
3.服务器计算response然后通过HTTP发回给用户
4.客户端持续的重复上述3步骤保持更新

说白了就是客户端一直请求服务器，问有没有新东西。例子有下载文件，隔一段时间看看是否下载完毕。

可想而知，有很多空请求。轮询的时间间隔需要进行仔细考虑。轮询的间隔过长，会导致用户不能及时接收到更新的数据；轮询的间隔过短，会导致查询请求过多，增加服务器端的负担。

## HTTP Long-Polling长轮询
Long-Polling就是当客户端向服务端发送请求，服务端无需马上回复。如果服务器没有新数据要发送，那么不会发送数据但是保持连接；一旦有新数据，该数据就立即被发送到客户端。  
大致的life cycle生命周期如下：  
1.客户端发动初始的HTTP连接请求
2.服务端delay回复直到有有效的数据或者发生超时
3.当有可用数据，服务器将所有数据回复给客户端
4.客户端大致上发送了一个长请求，要么马上得到回复，要么等待一阵获得回复
5.每个long-poll都有超时设置，客户端需要重新连接如果发生超时

说白了就是用户问服务端要东西，服务器心情好就给了，心情不好拖半天才给。不过你不请求不给你。

## WebSockets
WebSocket提供了Full duplex通信（全双工通信）频道在一个TCP连接里。它提供了持久化的客户端和服务端的连接，双方都可以随时发送信息，所以发送基本是实时的。

WebSocket在HTTP的基础上进行改进，成为了协议。只能在支持的设备和端之间使用。我们知道HTTP是无状态的，每次通信要发一堆无用表头，而WebSocket一次握手之后就建立了WebSocket协议层，就相当于在服务器和客户端搭建了管道，这边管道一丢另外一边就能收到。不过实际上因为网络的不确定性，WebStocket也会发送一些ping来维持连接状态，避免超时被踢掉。

说白了就是客户端服务端面对面聊天。例子有大型多人在线网游，聊天室等。

## Server-Sent Event (SSEs)
SSEs在客户端和服务端建立了持久化连接，服务端可以通过这个连接发数据给客户。但是客户端不能直接来发服务端。

说白了就是服务端主动给客户端发东西，说我有好东西给你。在HTML5新加入，例子有实时重要新闻的报道，发推文，流媒体股票价格实时图标，各种系统监控等。

IE/Edge不支持

## Reference
[各类“服务器推”技术原理与实例](https://juejin.im/post/5b135b78f265da6e420eab7d)  
[WebSocket 是什么原理？为什么可以实现持久连接？](https://www.zhihu.com/question/20215561)