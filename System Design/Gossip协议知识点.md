Gossip协议的知识点

## 什么是Gossip
Gossip英文意思就是流言，就是到处散布数据(流言)的一个过程。gossip 协议利用一种随机的方式将信息传播到整个网络中，并在一定时间内使得系统内的所有节点数据一致。Gossip 其实是一种去中心化思路的分布式协议，解决状态在集群中的传播和状态一致性的保证两个问题。

关键字：随机，去中心化，最终一致性

## Gossip工作原理
Gossip协议执行过程：  
1.种子节点周期性的散播消息 【假定把周期限定为 1 秒】。  
2.被感染节点随机选择N个邻接节点散播消息【假定fan-out(扇出)设置为6，每次最多往6个节点散播】。  
3.节点只接收消息不反馈结果。  
4.每次散播消息都选择尚未发送过的节点进行散播。  
5。收到消息的节点不再往发送节点散播：A -> B，那么B进行散播的时候，不再发给 A。  

Goosip协议的信息传播和扩散通常需要由种子节点发起。整个传播过程可能需要一定的时间，由于不能保证某个时刻所有节点都收到消息，但是理论上最终所有节点都会收到消息，因此它是一个最终一致性协议。

## 优缺点
pros:  
1.扩展性：允许节点的任意增加和减少，新增节点的状态 最终会与其他节点一致。  
2.容错：任意节点的宕机和重启都不会影响 Gossip 消息的传播，具有天然的分布式系统容错特性。  
3.去中心化：无需中心节点，所有节点都是对等的，任意节点无需知道整个网络状况，只要网络连通，任意节点可把消息散播到全网。  
4.一致性收敛：消息会以“一传十的指数级速度”在网络中传播，因此系统状态的不一致可以在很快的时间内收敛到一致。消息传播速度达到了logN。  
5.简单  

cons:   
1.消息延迟：节点随机向少数几个节点发送消息，消息最终是通过多个轮次的散播而到达全网；不可避免的造成消息延迟。   
2.消息冗余：节点定期随机选择周围节点发送消息，而收到消息的节点也会重复该步骤；不可避免的引起同一节点消息多次接收，增加消息处理压力。   

## Gossip应用场景
gossip 协议可以支持以下需求：  
1.Database replication  
2.消息传播  
3.Cluster membership  
4.Failure 检测  
5.Overlay Networks  
6.Aggregations (比如计算平均值、最大值以及总和)  

在下面的工程上使用到了gossip协议: 
1.Riak（https://github.com/basho/riak）使用gossip协议来共享和传递集群的环状态（ring state）和存储桶属性（bucket properties）。  
2.Cassandra：节点间的信息交换使用了 gossip 协议，因此所有节点都可以快速了解集群中的所有其他节点。  
3.Dynamo：采用基于gossip协议的分布式故障检测和成员协议，这样集群中添加或移除节点，其他节点可以快速检测到。  
4.Consul：使用了称为SERF的gossip协议，主要有两个目的：1、发现新的节点或者发现故障节点；2、为一些重要的事件（比如Leader选举）传播提供可靠、快速的传播  
5.Amazon s3：使用gossip协议将服务的状态传递给系统。  

## Reference
[分布式原理：一文了解 Gossip 协议](https://blog.csdn.net/b6ecl1k7BS8O/article/details/86653449)  
[Gossip 协议详解](https://zhuanlan.zhihu.com/p/162971102)  
